{"version":3,"sources":["helpers.js"],"names":["promisify","fn","callback","arguments","length","apply","args","Promise","resolve","reject","push","err","value","uriEscape","string","split","reduce","acc","elem","buf","Buffer","from","i","toString","toUpperCase","uriResourceEscape","replace","getScope","region","date","makeDateShort","isAmazonEndpoint","endpoint","isVirtualHostStyle","protocol","bucket","pathStyle","indexOf","ipv4Regex","isValidIP","ip","test","isValidEndpoint","isValidDomain","host","isString","substr","alphaNumerics","probeContentType","path","contentType","mime","lookup","isValidPort","port","isNumber","min_port","max_port","isValidBucketName","match","isValidObjectName","objectName","isValidPrefix","prefix","arg","isFunction","isObject","isReadableStream","_read","isBoolean","isArray","Array","isValidDate","Date","isNaN","makeDateLong","toISOString","pipesetup","streams","src","dst","on","emit","pipe","readableStream","data","s","stream","Readable","insertContentType","metaData","filePath","key","toLowerCase","newMetadata","Object","assign","prependXAMZMeta","isAmzHeader","isSupportedHeader","isStorageclassHeader","temp","startsWith","supported_headers","extractMetadata","slice","getVersionId","headers","versionIdValue","sanitizeETag","etag","replaceChars","m","RETENTION_MODES","GOVERNANCE","COMPLIANCE","RETENTION_VALIDITY_UNITS","DAYS","YEARS","LEGAL_HOLD_STATUS","ENABLED","DISABLED"],"mappings":"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","sourcesContent":["/*\n * MinIO Javascript Library for Amazon S3 Compatible Cloud Storage, (C) 2015 MinIO, Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport stream from 'stream'\nimport mime from 'mime-types'\n\n// Returns a wrapper function that will promisify a given callback function.\n// It will preserve 'this'.\nexport function promisify(fn) {\n  return function() {\n    // If the last argument is a function, assume its the callback.\n    let callback = arguments[arguments.length - 1]\n\n    // If the callback is given, don't promisify, just pass straight in.\n    if (typeof callback === 'function') return fn.apply(this, arguments)\n\n    // Otherwise, create a new set of arguments, and wrap\n    // it in a promise.\n    let args = [...arguments]\n\n    return new Promise((resolve, reject) => {\n      // Add the callback function.\n      args.push((err, value) => {\n        if (err) return reject(err)\n\n        resolve(value)\n      })\n\n      // Call the function with our special adaptor callback added.\n      fn.apply(this, args)\n    })\n  }\n}\n\n// All characters in string which are NOT unreserved should be percent encoded.\n// Unreserved characers are : ALPHA / DIGIT / \"-\" / \".\" / \"_\" / \"~\"\n// Reference https://tools.ietf.org/html/rfc3986#section-2.2\nexport function uriEscape(string) {\n  return string.split('').reduce((acc, elem) => {\n    let buf = Buffer.from(elem)\n    if (buf.length === 1) {\n      // length 1 indicates that elem is not a unicode character.\n      // Check if it is an unreserved characer.\n      if ('A' <= elem && elem <= 'Z' ||\n          'a' <= elem && elem <= 'z' ||\n          '0' <= elem && elem <= '9' ||\n          elem === '_' ||\n          elem === '.' ||\n          elem === '~' ||\n          elem === '-')\n      {\n        // Unreserved characer should not be encoded.\n        acc = acc + elem\n        return acc\n      }\n    }\n    // elem needs encoding - i.e elem should be encoded if it's not unreserved\n    // character or if it's a unicode character.\n    for (var i = 0; i < buf.length; i++) {\n      acc = acc + \"%\" + buf[i].toString(16).toUpperCase()\n    }\n    return acc\n  }, '')\n}\n\nexport function uriResourceEscape(string) {\n  return uriEscape(string).replace(/%2F/g, '/')\n}\n\nexport function getScope(region, date) {\n  return `${makeDateShort(date)}/${region}/s3/aws4_request`\n}\n\n// isAmazonEndpoint - true if endpoint is 's3.amazonaws.com' or 's3.cn-north-1.amazonaws.com.cn'\nexport function isAmazonEndpoint(endpoint) {\n  return endpoint === 's3.amazonaws.com' || endpoint === 's3.cn-north-1.amazonaws.com.cn'\n}\n\n// isVirtualHostStyle - verify if bucket name is support with virtual\n// hosts. bucketNames with periods should be always treated as path\n// style if the protocol is 'https:', this is due to SSL wildcard\n// limitation. For all other buckets and Amazon S3 endpoint we will\n// default to virtual host style.\nexport function isVirtualHostStyle(endpoint, protocol, bucket, pathStyle) {\n  if (protocol === 'https:' && bucket.indexOf('.') > -1) {\n    return false\n  }\n  return isAmazonEndpoint(endpoint) || !pathStyle\n}\n\nvar ipv4Regex = /^(\\d{1,3}\\.){3,3}\\d{1,3}$/\n\nexport function isValidIP(ip) {\n  return ipv4Regex.test(ip)\n}\n\n// isValidEndpoint - true if endpoint is valid domain.\nexport function isValidEndpoint(endpoint) {\n  if (!isValidDomain(endpoint) && !isValidIP(endpoint)) {\n    return false\n  }\n  // Return true.\n  return true\n}\n\n// isValidDomain - true if input host is a valid domain.\nexport function isValidDomain(host) {\n  if (!isString(host)) return false\n  // See RFC 1035, RFC 3696.\n  if (host.length === 0 || host.length > 255) {\n    return false\n  }\n  // Host cannot start or end with a '-'\n  if (host[0] === '-' || host.substr(-1) === '-') {\n    return false\n  }\n  // Host cannot start or end with a '_'\n  if (host[0] === '_' || host.substr(-1) === '_') {\n    return false\n  }\n  // Host cannot start with a '.'\n  if (host[0] === '.') {\n    return false\n  }\n  var alphaNumerics = '`~!@#$%^&*()+={}[]|\\\\\"\\';:><?/'.split('')\n  // All non alphanumeric characters are invalid.\n  for (var i in alphaNumerics) {\n    if (host.indexOf(alphaNumerics[i]) > -1) {\n      return false\n    }\n  }\n  // No need to regexp match, since the list is non-exhaustive.\n  // We let it be valid and fail later.\n  return true\n}\n\n// Probes contentType using file extensions.\n// For example: probeContentType('file.png') returns 'image/png'.\nexport function probeContentType(path) {\n  let contentType = mime.lookup(path)\n  if (!contentType) {\n    contentType = 'application/octet-stream'\n  }\n  return contentType\n}\n\n// isValidPort - is input port valid.\nexport function isValidPort(port) {\n  // verify if port is a number.\n  if (!isNumber(port)) return false\n  // port cannot be negative.\n  if (port < 0) return false\n  // port '0' is valid and special case return true.\n  if (port === 0) return true\n  var min_port = 1\n  var max_port = 65535\n  // Verify if port is in range.\n  return port >= min_port && port <= max_port\n}\n\nexport function isValidBucketName(bucket) {\n  if (!isString(bucket)) return false\n\n  // bucket length should be less than and no more than 63\n  // characters long.\n  if (bucket.length < 3 || bucket.length > 63) {\n    return false\n  }\n  // bucket with successive periods is invalid.\n  if (bucket.indexOf('..') > -1) {\n    return false\n  }\n  // bucket cannot have ip address style.\n  if (bucket.match(/[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+/)) {\n    return false\n  }\n  // bucket should begin with alphabet/number and end with alphabet/number,\n  // with alphabet/number/.- in the middle.\n  if (bucket.match(/^[a-z0-9][a-z0-9.-]+[a-z0-9]$/)) {\n    return true\n  }\n  return false\n}\n\n// check if objectName is a valid object name\nexport function isValidObjectName(objectName) {\n  if (!isValidPrefix(objectName)) return false\n  if (objectName.length === 0) return false\n  return true\n}\n\n// check if prefix is valid\nexport function isValidPrefix(prefix) {\n  if (!isString(prefix)) return false\n  if (prefix.length > 1024) return false\n  return true\n}\n\n// check if typeof arg number\nexport function isNumber(arg) {\n  return typeof(arg) === 'number'\n}\n\n// check if typeof arg function\nexport function isFunction(arg) {\n  return typeof(arg) === 'function'\n}\n\n// check if typeof arg string\nexport function isString(arg) {\n  return typeof(arg) === 'string'\n}\n\n// check if typeof arg object\nexport function isObject(arg) {\n  return typeof(arg) === 'object' && arg !== null\n}\n\n// check if object is readable stream\nexport function isReadableStream(arg) {\n  return isObject(arg) && isFunction(arg._read)\n}\n\n// check if arg is boolean\nexport function isBoolean(arg) {\n  return typeof(arg) === 'boolean'\n}\n\n// check if arg is array\nexport function isArray(arg) {\n  return Array.isArray(arg)\n}\n\n// check if arg is a valid date\nexport function isValidDate(arg) {\n  return arg instanceof Date && !isNaN(arg)\n}\n\n// Create a Date string with format:\n// 'YYYYMMDDTHHmmss' + Z\nexport function makeDateLong(date) {\n  date = date || new Date()\n\n  // Gives format like: '2017-08-07T16:28:59.889Z'\n  date = date.toISOString()\n\n  return date.substr(0, 4) +\n    date.substr(5, 2) +\n    date.substr(8, 5) +\n    date.substr(14, 2) +\n    date.substr(17, 2) + 'Z'\n}\n\n// Create a Date string with format:\n// 'YYYYMMDD'\nexport function makeDateShort(date) {\n  date = date || new Date()\n\n  // Gives format like: '2017-08-07T16:28:59.889Z'\n  date = date.toISOString()\n\n  return date.substr(0, 4) +\n    date.substr(5, 2) +\n    date.substr(8, 2)\n}\n\n// pipesetup sets up pipe() from left to right os streams array\n// pipesetup will also make sure that error emitted at any of the upstream Stream\n// will be emitted at the last stream. This makes error handling simple\nexport function pipesetup(...streams) {\n  return streams.reduce((src, dst) => {\n    src.on('error', err => dst.emit('error', err))\n    return src.pipe(dst)\n  })\n}\n\n// return a Readable stream that emits data\nexport function readableStream(data) {\n  var s = new stream.Readable()\n  s._read = () => {}\n  s.push(data)\n  s.push(null)\n  return s\n}\n\n// Process metadata to insert appropriate value to `content-type` attribute\nexport function insertContentType(metaData, filePath) {\n  // check if content-type attribute present in metaData\n  for (var key in metaData) {\n    if (key.toLowerCase() === 'content-type') {\n      return metaData\n    }\n  }\n  // if `content-type` attribute is not present in metadata,\n  // then infer it from the extension in filePath\n  var newMetadata = Object.assign({}, metaData)\n  newMetadata['content-type'] = probeContentType(filePath)\n  return newMetadata\n}\n\n// Function prepends metadata with the appropriate prefix if it is not already on\nexport function prependXAMZMeta(metaData) {\n  var newMetadata = Object.assign({}, metaData)\n  for (var key in metaData) {\n    if(!isAmzHeader(key) && !isSupportedHeader(key) && !isStorageclassHeader(key)) {\n      newMetadata[\"X-Amz-Meta-\" + key ] = newMetadata[key]\n      delete newMetadata[key]\n    }\n  }\n  return newMetadata\n}\n\n// Checks if it is a valid header according to the AmazonS3 API\nexport function isAmzHeader(key) {\n  var temp = key.toLowerCase()\n  return temp.startsWith(\"x-amz-meta-\") || temp === \"x-amz-acl\" || temp.startsWith(\"x-amz-server-side-encryption-\") || temp === \"x-amz-server-side-encryption\"\n}\n//Checks if it is a supported Header\nexport function isSupportedHeader(key) {\n  var supported_headers = [\n    'content-type',\n    'cache-control',\n    'content-encoding',\n    'content-disposition',\n    'content-language',\n    'x-amz-website-redirect-location']\n  return (supported_headers.indexOf(key.toLowerCase()) > -1)\n}\n//Checks if it is a storage header\nexport function isStorageclassHeader(key) {\n  return key.toLowerCase() === \"x-amz-storage-class\"\n}\n\nexport function extractMetadata(metaData) {\n  var newMetadata = {}\n  for (var key in metaData) {\n    if(isSupportedHeader(key) || isStorageclassHeader(key) || isAmzHeader(key)) {\n      if(key.toLowerCase().startsWith(\"x-amz-meta-\")) {\n        newMetadata[key.slice(11,key.length)] = metaData[key]\n      } else {\n        newMetadata[key] = metaData[key]\n      }\n    }\n  }\n  return newMetadata\n}\n\n\nexport function getVersionId(headers={}){\n  const versionIdValue = headers[\"x-amz-version-id\"]\n  return  versionIdValue || null\n}\n\nexport function sanitizeETag(etag='') {\n  var replaceChars = {'\"':'','&quot;':'','&#34;':'','&QUOT;':'','&#x00022':''}\n  return etag.replace(/^(\"|&quot;|&#34;)|(\"|&quot;|&#34;)$/g, m => replaceChars[m])\n    \n}\n\nexport const RETENTION_MODES ={\n  GOVERNANCE:\"GOVERNANCE\",\n  COMPLIANCE:\"COMPLIANCE\"\n}\n\nexport const RETENTION_VALIDITY_UNITS={\n  DAYS:\"Days\",\n  YEARS:\"Years\"\n}\n\nexport const LEGAL_HOLD_STATUS={\n  ENABLED:\"ON\",\n  DISABLED:\"OFF\"\n}"],"file":"helpers.js"}